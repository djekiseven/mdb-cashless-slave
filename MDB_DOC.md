# Раздел 1

## Общая информация

### 1.1 Введение

Этот документ определяет интерфейс последовательной шины для электронно-управляемых торговых автоматов. Интерфейс представляет собой систему Master-Slave со скоростью 9600 бод, где все периферийные устройства являются Slave-устройствами по отношению к Master-контроллеру.

Цель этого документа - стандартизировать торговые автоматы, использующие электронное управление (традиционно известное как контроллер механизма торгового автомата - VMC), чтобы все торговое и периферийное оборудование взаимодействовало одинаковым образом.

Следует отметить, что этот документ является спецификацией интерфейса/протокола торгового автомата, а не спецификацией системы торгового автомата. Каждый производитель автоматов должен предоставить спецификацию по общей работе автомата.

### 1.2 Операционные и прикладные примечания

Последовательная шина, или Multi-Drop Bus (MDB), настроена для работы в режиме Master-Slave. Есть один Master с возможностью взаимодействия с 32 периферийными устройствами. Master определяется как контроллер торгового автомата (VMC).

Каждому периферийному устройству назначается уникальный адрес и набор команд. Master будет "опрашивать" шину на наличие активности периферийных устройств. То есть, каждое периферийное устройство опрашивается на наличие активности и отвечает либо подтверждением, отрицательным подтверждением, либо специфическими данными в зависимости от его текущей активности. Если периферийное устройство не отвечает в течение предопределенного времени (t-non-response, как определено в разделах периферийных устройств), предполагается, что оно отсутствует на шине.

Помехи на шине или "конфликты" предотвращаются, поскольку каждое периферийное устройство отвечает только при опросе. Поскольку есть только один master, и вся коммуникация инициируется Master'ом, "конфликты" на шине легко предотвращаются.

Все периферийные устройства распознают команду или команды отключения, отправленные Master'ом. Это позволяет отключать отдельные периферийные устройства по различным причинам, например, для управления энергопотреблением.

Проверка и исправление ошибок осуществляется с помощью контрольных сумм (CHK) и команды повторной передачи.

### 1.3 Уровни и опции

С момента появления самой ранней спецификации Multi-Drop Bus были установлены функциональные уровни и операционные опции для большинства периферийных устройств на интерфейсе MDB/ICP. Они обеспечили возможность реализации новых функций по мере появления новых требований и возможностей для международной индустрии торговых автоматов.

#### 1.3.1 Уровни

Уровни функциональности периферийных устройств были установлены, когда в периферийном устройстве происходили значительные изменения, добавлявшие расширенные команды и ответы. Из-за потенциальных конфликтов между уровнем VMC и уровнем периферийного устройства, ни VMC, ни периферийное устройство не должны выдавать команду или отвечать с ответом, который не поддерживается другим устройством.

VMC должен изначально определить (через соответствующую команду STATUS или SETUP) уровень периферийного устройства, прежде чем определять, какие команды он может отправлять этому устройству. VMC должен отправлять только команды, поддерживаемые периферийным устройством. Например, команда уровня 3 может быть отправлена только периферийному устройству уровня 3 или выше и не должна отправляться периферийному устройству уровня 1 или 2.

Безналичное платежное устройство и универсальное спутниковое устройство также могут узнать соответствующий уровень VMC для этого устройства. Эта информация отправляется через команду SETUP. Периферийное устройство отвечает за отправку только тех ответов, которые поддерживаются VMC. Например, ответ уровня 3 может быть отправлен только VMC уровня 3 или выше и не должен отправляться VMC уровня 1 или 2. Фактически, VMC и периферийное устройство должны поддерживать наивысший общий уровень.

Для полной совместимости VMC и периферийные устройства должны поддерживать все более низкие уровни. Для новых разработок после июля 2000 года настоятельно рекомендуется, чтобы VMC и периферийные устройства поддерживали все более низкие уровни. Коммерческие или региональные вопросы могут заставить производителей автоматов или периферийных устройств реализовать только определенные уровни; однако это решение (и риск) принимается производителем автомата или периферийного устройства.

#### 1.3.2 Опции

Опции были установлены в периферийных устройствах для обеспечения различных дополнительных операционных функций, которые могут потребоваться для конкретных приложений торговых автоматов. Как следует из названия, эти функции являются "дополнительными" к стандартному набору необходимой функциональности.

При включении питания и после сброса шины или команды RESET все опции отключены. Во время последовательностей инициализации VMC определяет дополнительные функции, поддерживаемые периферийными устройствами. Затем VMC включит функции, которые он будет использовать. До тех пор, пока функция не включена, периферийное устройство должно игнорировать специфические для функции команды и не отвечать специфическими для функции ответами.

#### 1.3.3 Текущие установленные уровни и опции

Следующая таблица предоставляет краткое описание каждого из текущих установленных уровней и опций различных периферийных устройств MDB/ICP. Пожалуйста, обратитесь к конкретным разделам для каждого устройства для получения более подробной информации.

##### Монетоприемник (Coin Changer)

- Уровень 1: Никогда не выпускался
- Уровень 2: Поддерживает стандартные команды
- Уровень 3: Поддерживает команду Expansion ID и опционально поддерживает команды для следующих функций:
  - b0: Альтернативный метод выплаты
  - b1: Расширенная диагностика
  - b2: Контролируемое ручное наполнение и выплата
  - b3: File Transport Layer (FTL)

##### Купюроприемник (Bill Validator)

- Уровень 1: Поддерживает стандартные команды и команду Expansion ID без опций
- Уровень 2: Поддерживает команду Expansion ID с опциями и опционально поддерживает команды для следующих функций:
  - b0: File Transport Layer (FTL)
  - b1: Рециркуляция купюр

##### Безналичное устройство #1 и #2 (Cashless Device)

- Уровень 1: Поддерживает стандартные команды и команду Expansion ID. Считыватели не имеют возможности пополнения
  - b0*: Считыватель способен восстанавливать средства на карте
  - b1*: Считыватель поддерживает мультивенд
  - b2*: Считыватель имеет доступный дисплей
  - b3*: Считыватель поддерживает команду VEND-CASH SALE
  *биты в команде SETUP-Config

- Уровень 2: Поддерживает команды Revalue, Time/Date, Read User File (устарело) и Write User File (устарело)

- Уровень 3: Поддерживает команду Expansion ID с опциями и опционально поддерживает команды для следующих функций:
  - b0**: File Transport Layer (FTL)
  - b1**: 16 или 32-битный денежный формат
  - b2**: Мультивалютность / Мультиязычность
  - b3**: Отрицательная продажа
  - b4**: Ввод данных
  - b5**: Всегда активная сессия
  - b6** (MDB 4.3): Разрешить функцию "удаленной продажи", которая позволяет безналичному устройству инициировать процесс выдачи без интерфейса пользователя торгового автомата
  - b7** (MDB 4.3): Разрешить функцию "корзина/частичный возврат/опции цены" (позволяет выполнять несколько продаж с одним VEND REQUEST и несколькими VEND SUCCESS / VEND FAILURE)
  - b8** (MDB 4.3): Разрешить функцию "купон", позволяющую сканировать предоплаченные купоны для разрешения безналичному устройству вносить кредит для предоплаченных продаж в дополнение к стандартным картам с хранением кредита (например, QR-код для бесплатной выдачи определенного продукта)
  - b9** (MDB 4.3): Разрешить функцию "Ask Begin Session" в режиме "сначала выбор" (b5 также должен быть установлен в 1)
  - b10** (MDB 4.3): Разрешить "расширенную информацию о номере товара". Добавить номер выданного товара и поля EVA-DTS PA101 для выбранного и выданного товара в 7.4.7 Vend Success и 7.4.10 Cash Sale
  **биты в команде Level 3 Expansion ID

##### Коммуникационный шлюз (Communications Gateway)

- Уровень 1: Устарел (бывший аудиторский блок)
- Уровень 2: Устарел (бывший аудиторский блок)
- Уровень 3: Поддерживает команду Expansion ID и опционально поддерживает команды для следующих функций:
  - b0: File Transport Layer (FTL)
  - b1: Подробный режим
  - b2: Расширенные дата/время

##### Универсальное спутниковое устройство (Universal Satellite Device, USD)

- Уровень 1: Поддерживает все базовые команды и опционально поддерживает команды для следующих функций:
  - b0: USD способен хранить и контролировать цены
  - b1: USD способен выбирать товары для продажи
  - b2: File Transport Layer (FTL)

##### Монетный хоппер или трубка-диспенсер (Coin Hopper or Tube - Dispenser)

- Уровень 1: Поддерживает команду Expansion ID и опционально поддерживает команды для следующих функций:
  - b0: File Transport Layer (FTL)

# Раздел 2

## Формат коммуникации

### 2.1 Формат байта

Скорость передачи: 9600 бод NRZ

Формат последовательного бита:
- 1 стартовый бит
- 8 бит данных
- 1 бит режима
- 1 стоповый бит
- Всего 11 бит

LSB MSB
Старт 0 1 2 3 4 5 6 7 Режим Стоп

#### Бит режима: Master-to-Peripheral
Бит режима различает между байтами АДРЕСА и байтами ДАННЫХ. Байты АДРЕСА должны быть прочитаны всеми периферийными устройствами, байты ДАННЫХ читаются только тем периферийным устройством, которое было адресовано.

Бит режима устанавливается (логическая единица) для указания байта АДРЕСА и не устанавливается (логический ноль) для указания байта ДАННЫХ.

#### Бит режима: Peripheral-to-Master
Бит режима должен быть установлен на последнем отправляемом байте при передаче данных от Slave к Master.

### 2.2 Формат блока

#### Master-to-Peripheral
Коммуникационный блок для передач Master-to-Slave определяется как байт адреса, опциональные байты данных и байт CHK. Блок ограничен максимумом в тридцать шесть (36) байт.

Верхние пять бит (MSB) байта адреса будут использоваться для адресации. То есть, биты 7,6,5,4,3 предыдущего описания байта будут использоваться для адресации.

Нижние три бита (т.е. 2,1,0) байта адреса будут содержать специфичные для периферийного устройства команды. Это позволит встроить до восьми инструкций в первый байт блока.

VMC Master будет отвечать на данные от периферийного устройства подтверждением (ACK), отрицательным подтверждением (NAK) или запросом повторной передачи (RET). Они определены далее в документе. Тайм-аут 5 мс (t-response), описанный в разделе "Временные характеристики шины" этого документа, эквивалентен NAK.

Если адресованный Slave не отвечает в течение тайм-аута 5 мс (тишина), Master может повторять ту же команду или отправлять другую команду, пока не получит ответ или до окончания времени отсутствия ответа, как определено в разделах периферийных устройств. См. пример в 2.5D. Команда RESET не должна использоваться как метод восстановления после тайм-аута 5 мс (t-response) до истечения времени отсутствия ответа. VMC может отправлять команды любому другому периферийному устройству в течение этого времени.

#### Peripheral-to-Master
Коммуникационный блок для передач Slave-to-Master состоит либо из блока данных и байта CHK, подтверждения (ACK) или отрицательного подтверждения (NAK).

Тайм-аут 5 мс (t-response), описанный в разделе "Временные характеристики шины" этого документа, эквивалентен команде NAK. Кроме того, рекомендуется, чтобы периферийное устройство использовало этот тайм-аут как NAK при возникновении ошибки приема байта АДРЕСА. Это предотвратит попытки нескольких периферийных устройств одновременно ответить с NAK.

Блок данных состоит из одного или нескольких байтов данных, за которыми следует байт CHK. Байт CHK определен далее в этом документе.

Блок данных и байт CHK ограничены максимальным размером в 36 байт.

Байт CHK не требуется, когда периферийное устройство отвечает байтом NAK или ACK. ACK и NAK определены далее в этом документе.

Периферийное устройство должно установить бит режима на последнем отправляемом байте, чтобы обозначить конец передачи. Это будет либо байт CHK блока, байт NAK, либо байт ACK. Бит режима не должен устанавливаться, кроме как для указанных выше условий.

Ответ периферийного устройства ACK или NAK означает конец обмена.

Когда периферийное устройство отвечает блоком данных, VMC должен ответить ACK, NAK или RET. Если Master не может ответить в течение тайм-аута 5 мс (t-response), периферийное устройство должно повторить блок данных или добавить его при следующей возможности (т.е. к следующему POLL). То же поведение должно применяться, когда Master отвечает NAK.

#### Байт CHK
Байт CHK должен быть отправлен в конце каждого блока данных. Байт CHK является контрольной суммой, рассчитанной путем сложения байта АДРЕСА и всех байтов ДАННЫХ. Байт CHK не включается в суммирование. Бит переноса для сложения CHK игнорируется, так как байт CHK ограничен восемью битами.

Следующий пример показывает вычисление байта CHK для возможного ответа на команду STATUS, отправленную монетоприемнику USA. См. раздел 5 для подробного описания значений байтов.

```
02H Уровень функциональности монетоприемника
00H Код страны для USA
01H Код страны для USA
05H Коэффициент масштабирования монет
02H Десятичная точка
00H Маршрутизация типа монет
07H Маршрутизация типа монет
01H Монета типа 0 имеет значение 1 коэффициента масштабирования
02H Монета типа 1 имеет значение 2 коэффициента масштабирования
05H Монета типа 2 имеет значение 5 коэффициента масштабирования
14H Монета типа 3 имеет значение 20 коэффициента масштабирования
FFH Монета типа 4 является жетоном
12CH Следовательно, байт CHK будет равен 2CH
```

Контрольная сумма будет выполняться на всех полных блоках коммуникации. Контрольная сумма не будет выполняться на байтах ACK, NAK или RET.

#### Коды ответов
Следующие коды зарезервированы для байтов ACK, NAK и RET:

**Примечание:**
- ACK 00H (подтверждение/контрольная сумма верна)
- RET AAH (Повторная передача ранее отправленных данных.
       Только VMC может передавать этот байт)
- NAK FFH (Отрицательное подтверждение)

VMC и периферийное устройство также должны распознавать тайм-аут 5 мс (t-response) как NAK.

Для улучшения надежности системы рекомендуется, чтобы при получении ACK, NAK или RET принимающее устройство подсчитывало количество установленных битов в байте. Этот метод потребует как минимум две ошибки в битах байта, прежде чем байт может быть неправильно интерпретирован.

#### Сброс шины

VMC может сбросить все периферийные устройства, удерживая линию передачи "активной" как минимум 100 мс. Это информирует все периферийные устройства о необходимости прервать любую активность и вернуться в состояние сброса при включении питания. Подробности этого состояния для каждого периферийного устройства приведены в последующих разделах этого документа. Рекомендуется, чтобы VMC повторно инициализировал каждое периферийное устройство после такого типа сброса.

### 2.3 Адреса периферийных устройств

Ниже приведены определенные адреса. Обратите внимание, что показанные биты являются верхними пятью битами (7,6,5,4,3) байта адреса и будут использоваться для всей адресации, включая File Transport Layer, описанный в разделе 2.6. Нижние три бита (2,1,0) используются для команд.

| Адрес | Определение |
|---------|---------------|
| 00000xxxB (00H) | Зарезервировано для VMC |
| 00001xxxB (08H) | Монетоприемник |
| 00010xxxB (10H) | Безналичное устройство #1 |
| 00011xxxB (18H) | Коммуникационный шлюз |
| 00100xxxB (20H) | Дисплей |
| 00101xxxB (28H) | Система управления энергопотреблением |
| 00110xxxB (30H) | Купюроприемник |
| 00111xxxB (38H) | Зарезервировано для будущих стандартных периферийных устройств |
| 01000xxxB (40H) | Универсальное спутниковое устройство #1 |
| 01001xxxB (48H) | Универсальное спутниковое устройство #2 |
| 01010xxxB (50H) | Универсальное спутниковое устройство #3 |
| 01011xxxB (58H) | Монетный хоппер или трубка-диспенсер 1 |
| 01100xxxB (60H) | Безналичное устройство #2 |
| 01101xxxB (68H) | Устройство проверки возраста |
| 01101xxxB (70H) | Монетный хоппер или трубка-диспенсер 2 |
| 01111xxxB (78H) | Зарезервировано для будущих стандартных периферийных устройств |
| ... | ... |
| 11011xxxB (D8H) | Зарезервировано для будущих стандартных периферийных устройств |
| 11100xxxB (E0H) | Экспериментальное периферийное устройство #1 |
| 11101xxxB (E8H) | Экспериментальное периферийное устройство #2 |
| 11110xxxB (F0H) | Специфическое периферийное устройство торгового автомата #1 |
| 11111xxxB (F8H) | Специфическое периферийное устройство торгового автомата #2 |

#### Адреса экспериментальных периферийных устройств

Адреса экспериментальных периферийных устройств 11100xxxB (E0H) и 11101xxxB (E8H) зарезервированы для использования производителями при разработке и полевых испытаниях потенциальных новых устройств MDB/ICP. Эти адреса являются временными, и после того, как новое устройство будет одобрено NAMA и EVA, устройству будет назначен другой постоянный периферийный адрес. Использование адресов экспериментальных периферийных устройств должно быть ограничено "внутренними" тестами и "закрытыми" полевыми испытаниями. Производители должны понимать, что любые устройства в поле с адресами экспериментальных периферийных устройств должны быть отозваны или обновлены до постоянного адреса, если устройство одобрено NAMA и EVA. Если не одобрено NAMA и EVA, устройства должны быть отозваны или их адреса должны быть изменены на адреса специфических периферийных устройств торгового автомата, описанные ниже.

#### Адреса специфических периферийных устройств торгового автомата

Адреса специфических периферийных устройств торгового автомата (адреса 11110xxxB (F0H) и 11111xxxB (F8H)) зарезервированы для нестандартных или проприетарных приложений. Этим устройствам разрешен уникальный набор команд.

Все остальные периферийные устройства определены как стандартные устройства. Эти периферийные устройства должны следовать спецификациям для обеспечения совместимости между производителями.

### 2.4 Правила работы программного обеспечения

#### 2.4.1 Бюджет питания

VMC должен регулировать бюджет питания. То есть, периферийные устройства должны включаться и отключаться в зависимости от доступности питания. Шина питания определена далее в этом документе.

#### 2.4.2 Байты

Во время многобайтных сообщений сначала отправляется наиболее значимый байт.

Любые байты в команде или ответе, которые не определены явно, должны быть оставлены в состоянии 0. Для монетоприемников уровня 03 или ниже, купюроприемников уровня 01 и картридеров уровня 01 это не является требованием, а предложением.

#### 2.4.3 Опрос

Следующие рекомендации относятся к методам работы программного обеспечения VMC с периферийными устройствами.

Каждое периферийное устройство должно опрашиваться каждые 25-200 миллисекунд. Это может быть сделано с помощью команды POLL или любой другой подходящей команды.

Если периферийное устройство не ответило на опрос в течение своего максимального времени отсутствия ответа, VMC должен продолжать опрашивать периферийное устройство как минимум каждые десять секунд с помощью команды RESET. (См. Пример G в Разделе 2.5).

#### 2.4.4 Уровни

Из-за потенциальных конфликтов между уровнем VMC и уровнем периферийного устройства, ни VMC, ни периферийное устройство не должны выдавать команду или отвечать с ответом, который не поддерживается другим устройством.

VMC должен изначально определить (через соответствующую команду STATUS или SETUP) уровень периферийного устройства, прежде чем определять, какие команды он может отправлять этому устройству. VMC должен отправлять только команды, поддерживаемые периферийным устройством. Например, команда уровня 3 может быть отправлена только периферийному устройству уровня 3 или выше и не должна отправляться периферийному устройству уровня 1 или 2.

Безналичное платежное устройство и универсальное спутниковое устройство также могут узнать соответствующий уровень VMC для этого устройства. Эта информация отправляется через команду SETUP. Периферийное устройство отвечает за отправку только тех ответов, которые поддерживаются VMC. Например, ответ уровня 3 может быть отправлен только VMC уровня 3 или выше и не должен отправляться VMC уровня 1 или 2. Фактически, VMC и периферийное устройство должны поддерживать наивысший общий уровень.

Для полной совместимости VMC и периферийные устройства должны поддерживать все более низкие уровни. Для новых разработок после июля 2000 года настоятельно рекомендуется, чтобы VMC и периферийные устройства поддерживали все более низкие уровни. Коммерческие или региональные вопросы могут заставить производителей автоматов или периферийных устройств реализовать только определенные уровни; однако это решение (и риск) принимается производителем автомата или периферийного устройства.

### 2.5 Типичные примеры сессий

#### A. Простой опрос
Следующая диаграмма представляет типичную передачу, когда периферийное устройство находится в режиме ожидания.

```
VMC:
ADD* CHK
Периферийное устройство:
ACK*
```

#### B. Ответ с данными
Следующая диаграмма представляет типичную передачу, когда периферийное устройство имеет данные для возврата.

```
VMC:
ADD* CHK ACK
Периферийное устройство:
DAT DAT CHK*
```

#### C. Отправка данных
Следующая диаграмма представляет типичную передачу, когда VMC имеет данные для отправки.

```
VMC:
ADD* DAT DAT CHK
Периферийное устройство:
ACK*
```

*Указывает на установленный бит режима

#### D. Обработка ошибок
Следующая диаграмма представляет типичную передачу, когда VMC определяет, что CHK неверен. VMC ответит одним из двух способов:

Отправит NAK периферийному устройству, чтобы указать, что информация не была получена правильно, затем выполнит другие задачи. Примечание: Когда Master отвечает NAK (или тишиной, что рассматривается одинаково), slave должен повторить ответ, чтобы обеспечить выполнение ответа (например, прием монет и т.д.).

ИЛИ

VMC может отправить команду повторной передачи (RET), уведомляющую периферийное устройство о необходимости повторно передать ранее отправленные данные.

```
VMC:
ADD* DAT CHK RET ACK
Периферийное устройство:
DAT DAT CHK* DAT DAT CHK*
```

*Указывает на установленный бит режима.

### 2.6 File Transport Layer (FTL)

File Transport Layer (FTL) предоставляет метод для отправки и/или получения информации высокого уровня между периферийными устройствами или между периферийным устройством и VMC. Он не предназначен для использования в стандартных функциях управления кредитами и торговым автоматом. Примером может служить загрузка новых параметров валидации в монетоприемник или купюроприемник.

Поскольку интерфейс MDB/ICP управляется VMC, он должен быть сетевым менеджером для всех передач данных FTL. Он действует как временный почтовый ящик и коммутатор данных для блоков FTL; однако информация, отправляемая через FTL, не обязательно должна интерпретироваться VMC. VMC просто использует информацию об адресе назначения и источника, предоставленную в структуре команд и ответов MDB/ICP, для пересылки данных нужному получателю.

#### 2.6.1 Обзор процесса FTL

Если периферийному устройству необходимо передать данные другому периферийному устройству (или VMC):
- VMC должен опросить периферийное устройство
- Периферийное устройство должно ответить "REQUEST TO SEND"
- VMC должен получить одобрение на пересылку данных (если необходимо)
- VMC запрашивает первый блок данных
- VMC подтверждает первый блок и пересылает его получателю
- Процесс повторяется, пока не будут отправлены все блоки

Если VMC необходимо передать данные периферийному устройству:
- VMC должен отправить "REQUEST TO SEND"
- Периферийное устройство одобряет или отклоняет запрос на передачу
- Если одобрено, VMC отправляет первый блок данных
- Периферийное устройство подтверждает первый блок данных
- Процесс повторяется, пока не будут отправлены все блоки

Если периферийному устройству (A) необходимо запросить передачу данных от другого периферийного устройства (B):
- VMC должен опросить периферийное устройство A
- Периферийное устройство A должно отправить "REQUEST TO RECEIVE"
- VMC пересылает запрос периферийному устройству B
- Периферийное устройство B решает, выполнить запрос или нет
- Если одобрено, периферийное устройство B отправляет первый блок данных
- VMC пересылает блок данных периферийному устройству A
- Процесс повторяется, пока не будут отправлены все блоки

#### 2.6.2 Детальная работа VMC с FTL

VMC должен действовать как сетевой менеджер, он отвечает за проверку состояния периферийных устройств и управление сетевыми ресурсами, как описано ниже, он должен:
- Знать, какие периферийные устройства активны и поддерживают FTL. Если запрашивается передача файла с участием периферийного устройства, которое не поддерживает его, VMC должен отклонить передачу, используя RETRY/DENY, определенный далее.
- Опрашивать периферийные устройства, чтобы узнать о запросе на передачу данных.
- Считывать блоки данных с выбранных периферийных устройств.
- Если VMC получает NAK, он должен попытаться завершить текущую команду/ответ до 5 раз. После этого он должен прервать передачу файла, как определено протоколом.
- Отправлять блоки данных устройству назначения, если это не сам VMC.
- Повторять эти шаги для всех блоков данных по мере необходимости.

#### 2.6.3 Общая работа FTL

- "Сессия" FTL передает "файл", используя несколько "блоков". "Dest" и "Src" переключаются VMC, направляющим каждый блок к месту назначения.
- Все ответы могут быть отправлены сразу после получения команды, или команда может быть подтверждена (ACK), а ответ отправлен с задержкой (с соблюдением всех соответствующих тайм-аутов). Однако ответы FTL НЕ должны комбинироваться с ответами на любые другие команды в любое время.
- Передачи файлов менее 256 блоков завершаются отправкой пустого файла данных (SEND BLOCK без данных). Передачи файлов ровно 256 блоков завершаются блоком #FE, за которым следует блок #FF.
- Рекомендуется, чтобы файлы размером более одного блока:
  1) Включали CRC в свои данные. Транспортный уровень не отвечает за проверку правильности CRC.
  2) Включали механизм тайм-аута для предотвращения системных блокировок. Транспортный уровень не отвечает за проверку заблокированных передач файлов.
- Для предотвращения системной блокировки VMC должен опрашивать другие периферийные устройства во время всех передач данных и обслуживать их соответственно.
- Поскольку VMC не знает о содержимом передачи файла, он не должен отключать периферийные устройства из-за запроса на передачу. Это будет ответственностью самих периферийных устройств. Они могут внутренне отключаться и сообщать об этом VMC, если возможно, или просто перестать отвечать VMC до готовности. Последнее может заставить VMC попытаться перезагрузить периферийное устройство.

#### 2.6.4 Наборы команд и ответов FTL для всех компонентов

Таблица ниже определяет команды VMC и ответы периферийных устройств, которые происходят во время передачи данных FTL. Обратите внимание, что ответы периферийных устройств могут быть либо немедленными на команду VMC, либо отложенными и предоставленными в последующем POLL.

| Команда/Ответ | VMC Cmd1 | Resp | Источник данных (байты) | Назначение ответа |
|---------------|----------|------|-------------------------|-------------------|
| REQ TO SEND | α7/FE | 1F | Dest (1), Src (1), File ID (1), Length (1), Control (1) | OK TO SEND или RETRY/DENY |
| OK TO SEND | α7/FD | 1E | Dest (1), Src (1) | SEND BLOCK (повторяется до передачи всего файла) |
| SEND BLOCK | α7/FC | 1D | Dest (1), Block # (1), Data (1 to 31) | ACK |
| RETRY/DENY | α7/FB | 1C | Dest (1), Src (1), Retry delay (1) | ACK |
| REQ TO RCV | α7/FA | 1B | Dest (1), Src (1), File ID (1), Max Length (1), Control (1) | SEND BLOCK (повторяется до передачи всего файла) или RETRY/DENY |

Примечание 1: α7 представляет адрес устройства назначения (определенный в разделе 2.3), логически объединенный (OR) с шестнадцатеричным 0x07.

**Определения полей:**

**Dest** (1 байт)
Адрес назначения периферийного устройства, куда отправляется блок данных (не весь файл). Все адреса относятся к стандартным адресам периферийных устройств MDB, определенным в разделе 2.3. Обратите внимание, что 00000xxx (00H) будет использоваться для VMC. Примеры: монетоприемник (08H), аудит система (18H), купюроприемник (30H) и универсальное спутниковое устройство #2 (48H).

**Src** (1 байт)
Адрес источника периферийного устройства, откуда отправляется блок данных (не весь файл). Все адреса относятся к стандартным адресам периферийных устройств MDB, определенным в разделе 2.3. Обратите внимание, что 00000xxx (00H) будет использоваться для VMC. Примеры те же, что и в Dest выше.

**File ID** (1 байт)
Тип запрашиваемой информации. NAMA будет поддерживать список стандартных ID файлов и определение того, что означает каждый тип файла. Обратите внимание, что если устройство отвечает "Retry delay" FFH, это должно интерпретироваться как то, что это устройство не поддерживает запрошенную функцию.

В настоящее время определены следующие ID файлов:
- 00H: Информация о производителе. Этот файл должен начинаться с трехсимвольного кода производителя, все после этого определяется производителем.
- 01H: DTS-определенный файл. Этот файл должен следовать формату, определенному в стандарте EVA-DTS. Это включает запись DXS, а также все данные до и включая запись DXE.
- 0F0H до 0FFH: Этот диапазон файлов может использоваться для информации, специфичной для производителя. Содержание и формат этих файлов определяются производителем.

Дополнительные предложения по ID должны быть оценены техническим комитетом стандарта NAMA MDB/ICP.

**(Max) Length** (1 байт)
Общее количество блоков, которые будут (могут быть) включены во весь файл. Этот байт должен использоваться как счетчик для определения количества блоков данных для передачи.

**Control** (1 байт)
Этот байт содержит информацию, которая может использоваться VMC и периферийными устройствами для определения того, как проводится передача данных. Включенные элементы управления:
- b0: Сброс после передачи. Принимающее периферийное устройство должно сбросить себя после завершения передачи файла.
- b1: Конец файла. Последний блок текущей сессии FTL содержит конец этого файла. Если очищен (=0), то последует другая сессия FTL с дополнительными блоками. Если установлен (=1), то это последняя (или единственная) сессия FTL для отправки.
- b2 - b7: Не используются, должны быть установлены в 0.

**Block #** (1 байт)
Последовательный номер этого блока в общем файле, который запрашивается/отправляется. Все блоки данных должны быть идентифицированы номером блока, считая от 0 (первый блок) до 255.

**Data Block** (1-31 байт)
Фактическая часть данных блока. Все данные должны помещаться в строку длиной 31 байт или меньше. Стандартный байт CHK MDB будет обозначать конец блока. (Периферийные устройства должны использовать межбайтовый тайм-аут при получении блоков от VMC.) Знание содержимого этих данных требуется только устройствам источника и назначения.

**Retry Delay** (1 байт)
Временная задержка, которую отправитель должен выждать перед повторной попыткой отправки всего файла данных. Если устройство не способно принять файл в своем текущем состоянии, этот байт должен представлять количество секунд, через которое оно будет готово принять данные. Если устройство просто отказывается принять файл, оно должно ответить "Retry Never", обозначаемым задержкой повтора 00H. Если устройство отсутствует, потеряна синхронизация блоков или возникает другой режим отказа, должен использоваться "Retry Never" для прерывания/отклонения текущей передачи файла.

**Примеры передачи файлов через File Transport Layer**

Ниже приведены примеры передач данных между VMC и периферийным устройством или между двумя разными периферийными устройствами через VMC.

**УСПЕШНАЯ ПЕРЕДАЧА – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  REQ TO SEND
                  (α7/FE)
OK TO SEND (1E)                                         Запрос на отправку
                                                       "n" блоков
ACK
                  SEND BLOCK
                  (α7/FC)                              Повторяется "n" раз
ACK
```

**ОТКЛОНЕННАЯ ПЕРЕДАЧА – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  REQ TO SEND
                  (α7/FE)
RETRY/00 (1C)                                          Отклонено
ACK
```

**УСПЕШНЫЙ ЗАПРОС – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO RCV (1B)                                        Запрос на получение
                                                       "n" блоков
ACK
                  SEND BLOCK
                  (α7/FC)                              Повторяется "n" раз
ACK
```

**ОТКЛОНЕННЫЙ ЗАПРОС – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO RCV (1B)                                        Запрос на получение
                                                       "n" блоков
ACK
                  RETRY/00
                  (α7/FB)                              Отклонено
ACK
```

**ПРЕРВАННАЯ VMC ПЕРЕДАЧА – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  REQ TO SEND
                  (α7/FE)                              Запрос на отправку
                                                       "n" блоков
OK TO SEND (1E)
ACK
                  SEND BLOCK
                  (α7/FC)                              Повторяется "n" раз
ACK
                  RETRY/00
                  (α7/FB)                              Прервано!
ACK
```

**ПРЕРВАННАЯ ПЕРИФЕРИЙНЫМ УСТРОЙСТВОМ ПЕРЕДАЧА – VMC К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  REQ TO SEND
                  (α7/FE)                              Запрос на отправку
                                                       "n" блоков
OK TO SEND (1E)
ACK
                  SEND BLOCK
                  (α7/FC)
RETRY/00 (1C)                                          Прервано!
ACK
```

**УСПЕШНАЯ ПЕРЕДАЧА – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К VMC**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  OK TO SEND
                  (α7/FD)
SEND BLOCK (1D)                                        Повторяется "n" раз
ACK
```

**ОТКЛОНЕННАЯ ПЕРЕДАЧА – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К VMC**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  RETRY/00
                  (α7/FB)                              Отклонено
ACK
```

**УСПЕШНАЯ ПЕРЕДАЧА – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  REQ TO SEND
                  (α7/FE)
                                      OK TO SEND (1E)
SEND BLOCK (1D)
                  OK TO SEND
                  (α7/FD)                              Повторяется "n" раз
ACK
                  SEND BLOCK
                  (α7/FC)
                                      ACK
```

**ОТКЛОНЕННАЯ ПЕРЕДАЧА – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  REQ TO SEND
                  (α7/FE)
                                      RETRY/00 (1C)     Отклонено
                  RETRY/00
                  (α7/FB)
ACK
```

**УСПЕШНЫЙ ЗАПРОС – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO RCV (1B)                                        Запрос на получение
                                                       "n" блоков
ACK
                  REQ TO RCV
                  (α7/FA)
                                      SEND BLOCK (1D)   Повторяется "n" раз
                  SEND BLOCK
                  (α7/FC)
ACK
```

**ОТКЛОНЕННЫЙ ЗАПРОС – ПЕРИФЕРИЙНОЕ УСТРОЙСТВО A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO RCV (1B)                                        Запрос на получение
                                                       "n" блоков
ACK
                  REQ TO RCV
                  (α7/FA)
                                      RETRY/00 (1C)     Отклонено
                  RETRY/00
                  (α7/FB)
ACK
```

**ПЕРЕДАЧА ОТ ПЕРИФЕРИЙНОГО УСТРОЙСТВА A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B – ПРЕРВАНА A**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  REQ TO SEND
                  (α7/FE)
                                      OK TO SEND (1E)
                  OK TO SEND
                  (α7/FD)
SEND BLOCK (1D)
ACK
                  SEND BLOCK
                  (α7/FC)
                                      ACK
                  .
                  .                                    Повторяется "n" раз
                  .
                  POLL (varies)
RETRY/00 (1C)                                         Прервано!
ACK
                  RETRY/00
                  (α7/FB)
                                      ACK
```

**ПЕРЕДАЧА ОТ ПЕРИФЕРИЙНОГО УСТРОЙСТВА A К ПЕРИФЕРИЙНОМУ УСТРОЙСТВУ B – ПРЕРВАНА B**
```
Периферийное A    VMC                 Периферийное B    Комментарии
                  POLL (varies)
REQ TO SEND (1F)                                       Запрос на отправку
                                                       "n" блоков
ACK
                  REQ TO SEND
                  (α7/FE)
                                      OK TO SEND (1E)
                  OK TO SEND
                  (α7/FD)
SEND BLOCK (1D)
ACK
                  SEND BLOCK
                  (α7/FC)
                                      ACK
                  .
                  .                                    Повторяется "n" раз
                  .
                  POLL (varies)
                  REQ BLOCK
                  (α7/FD)
SEND BLOCK (1D)
ACK
                  SEND BLOCK
                  (α7/FC)
                                      RETRY/00 (1C)    Прервано!
                  RETRY/00
                  (α7/FB)
ACK
```
# Раздел 3

## Временные характеристики шины

### 3.1 Определения временных параметров

**Baud rate** = Скорость передачи битов в секунду.

**t inter-byte (max.)** = Максимально допустимое время между байтами в блочной передаче.

**t response (max.)** = Максимальное время, которое любое устройство, master или периферийное, будет затрачивать на ответ при действительной коммуникации.

**t break (VMC)** = Минимальное время сигнала сброса шины, отправляемого VMC для сброса всех периферийных устройств.

**t setup** = Минимальное время установки перед тем, как VMC попытается установить связь после сигнала сброса. Периферийные устройства могут выбрать не отвечать в течение времени отсутствия ответа, определенного в разделе каждого периферийного устройства.

### 3.2 Спецификации временных параметров

| Параметр | Значение |
|----------|----------|
| Baud Rate | 9600 +1%/-2% NRZ |
| t inter-byte (max.) | 1.0 мс |
| t response (max.) | 5.0 мс |
| t break (min.) | 100 мс |
| t setup (min.) | 200 мс |

**ПРИМЕЧАНИЕ:** Все периферийные устройства имеют возможность не отвечать VMC. Время отсутствия ответа определено в спецификации периферийного устройства.

### 3.3 Временная диаграмма

```
Контроллер (VMC)
DAT CHK      BREAK          SETUP          ADD*
─────┐ ┌──┐               ┌────────┐      ┌────
     │ │  │               │        │      │
     └─┘  └───────────────┘        └──────┘

Периферийное устройство
─────┐      ┌────
     │      │
     └──────┘                              ┌────
                                           │
                                           └────

     <-><->  <------>      <------>      <---->
     │   │      │             │             │
     │   │      │             │             └── t setup (min=200мс)
     │   │      │             └─────────────── t break (min=100мс)
     │   │      └─────────────────────────── t response (max=5мс)
     │   └────────────────────────────────── t inter-byte (max=1мс)
     └────────────────────────────────────── передача данных

* указывает на установленный бит режима
```
# Раздел 4

## Спецификация оборудования

### 4.1 Определение питания шины

Информация ниже определяет минимальные требования к выходному напряжению VMC. Фактические значения тока для каждого периферийного устройства будут определены в их соответствующих разделах.

Фильтрация источника питания является опциональной, поэтому если периферийному устройству требуется больше мощности или более жесткая регулировка, оно может использовать собственное питание или фильтрацию от доступных источников в другом месте машины.

Выходное напряжение VMC:
- Минимальное = 20 В постоянного тока (среднеквадратичное, выпрямленное и опционально фильтрованное)
- Номинальное = 34 В постоянного тока нерегулируемое (выпрямленное и фильтрованное)
  или 24 В постоянного тока среднеквадратичное (только выпрямленное)
- Максимальное = 42.5* В постоянного тока (верхний предел пульсаций напряжения)
  * При высоком входном напряжении допускается пиковое значение до 45 В постоянного тока

### 4.2 Спецификация передатчика/приемника шины

Следующий раздел описывает 5В оптически изолированную токовую петлю между Master и Slave устройствами.

#### VMC Master:

**Передача:**
- Минимальный ток источника (активный): 100 мА при 4В
- Максимальный ток утечки (неактивный): 100 мкА

**Примечания:**
1. Линия передачи должна выдерживать короткое замыкание в активном режиме
2. Следует добавить 15 мА для каждого периферийного устройства свыше шести

**Прием:**
- Минимальный входной ток (активный): 15 мА при 1В
- Максимальный входной ток (неактивный): 1 мА

#### Периферийное устройство (Slave):

**Прием:**
- Максимальный входной ток (активный): 15 мА при 4В
- Максимальный входной ток (неактивный): 100 мкА

**Передача:**
- Минимальный ток стока (активный): 15 мА при 1В
- Максимальный ток утечки (неактивный): 30 мкА

### 4.3 Спецификация разъемов

Сборки разъемов, поставляемые одобренными NAMA поставщиками, указанными в разделе 4.3.6, являются взаимозаменяемыми и соответствуют или превышают минимальные требования, определенные в разделах 4.3.1, 4.3.2, 4.3.3, 4.3.4 и 4.3.5 при тестировании в сопряженном состоянии.

NAMA должна одобрить любые изменения поставщиком в отношении посадки, формы или функции. Дискретные компоненты, т.е. контакты, не обязательно должны быть взаимозаменяемыми между продуктами разных поставщиков.

#### 4.3.1 Материалы

1. Терминал: Фосфористая бронза
2. Покрытие: Олово или Олово/Свинец
3. Корпус: Нейлон UL 94V-2

#### 4.3.2 Номинальные характеристики

| Параметр | Требование |
|----------|------------|
| Максимальное номинальное напряжение | 600 В переменного тока |
| Максимальный номинальный ток (шесть цепей) | 7 А |
| Диапазон температуры окружающей среды (включая повышение температуры терминала) | от -40°C до +105°C |
#### 4.3.3 Электрические характеристики

| Параметр | Условия тестирования | Требование |
|----------|---------------------|------------|
| Сопротивление контакта | Сопряженные разъемы, измерение сухой цепью, 20 мВ макс., 10 мА. Сопротивление провода должно быть исключено из измеренного значения. | 10 мОм макс. |
| Сопротивление изоляции | Сопряженные разъемы, приложить 500В постоянного тока между соседними терминалами или землей. | 1000 МОм мин. |
| Электрическая прочность | Сопряженные разъемы, приложить 1500В переменного тока в течение 1 минуты между соседними терминалами или землей. | Без пробоя |

#### 4.3.4 Механические характеристики

| Параметр | Условия тестирования | Требование |
|----------|---------------------|------------|
| Усилие вставки и извлечения | Вставка и извлечение разъемов со скоростью 25 ± 3мм/минуту | 6 поз. вставка макс.: Начальная 41.2 Н, 30-й цикл 38.2 Н<br>6 поз. извлечение мин.: Начальная 2.9 Н, 30-й цикл 2.4 Н |
| Усилие вытягивания обжима | Закрепить обжатый терминал, приложить осевое усилие к проводу со скоростью 25 ± 3мм/минуту | 16 AWG: 88 Н мин.<br>18 AWG: 88 Н мин.<br>20 AWG: 59 Н мин.<br>22 AWG: 39 Н мин.<br>24 AWG: 29 Н мин.<br>26 AWG: 20 Н мин.<br>28 AWG: 10 Н мин. |
| Усилие вставки терминала | Вставить обжатый терминал в корпус | 15 Н макс. |
| Усилие удержания терминала/корпуса | Приложить осевое усилие вытягивания со скоростью 25 ± 3мм/минуту | 22 Н мин. |
| Усилие блокировки/разблокировки | Измерить усилие блокировки и разблокировки корпусов разъемов (без контактов) со скоростью 25 ± 3мм/минуту | Блокировка: 30 Н макс.<br>Разблокировка: 50 Н мин. |

#### 4.3.5 Характеристики окружающей среды

| Параметр | Условия тестирования | Требование |
|----------|---------------------|------------|
| Повторное соединение/разъединение | При соединении до 30 циклов повторно со скоростью 10 циклов в минуту | Сопротивление контакта 20 мОм макс. |
| Повышение температуры | При номинальной токовой нагрузке | Повышение 30°C макс. |
| Вибрация | Амплитуда: 1.5мм P-P<br>Время развертки: 10-55-10 Гц за 1 минуту<br>Длительность: 2 часа по каждой оси X,Y,Z | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс.<br>Прерывание: 1 мкс макс. |
| Удар | 50 G; 3 удара по каждой оси X,Y,Z | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс.<br>Прерывание: 1 мкс макс. |
| Теплостойкость | 105 ± 2°C, 96 часов | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс. |
| Холодостойкость | -40 ± 3°C, 96 часов | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс. |
| Влажность | Температура: 60 ± 2°C<br>Относительная влажность: 90% - 95%<br>Длительность: 96 часов | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс.<br>Электрическая прочность: без пробоя<br>Сопротивление изоляции: 1000 МОм мин. |
| Температурное циклирование | 5 циклов:<br>a) -55°C; 30 минут<br>b) 105°C; 30 минут | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс. |
| Соляной туман | 48 ± 4 часа воздействия соляного тумана из 5 ± 1% раствора при 35 ± 2°C | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс. |
| Газ SO2 | 24 часа воздействия 50 ± 5 ppm газа SO2 при 40 ± 2°C | Внешний вид: без повреждений<br>Сопротивление контакта: 20 мОм макс. |

#### 4.3.6 Одобренные поставщики и номера деталей

##### 4.3.6.1 Поставщики
- Molex: Mini-Fit, Jr.™ Product
- AMP: AMP-DUAC™ Product

##### 4.3.6.2 Периферийные устройства

**Разъем:** Шестиконтактный (6) корпус розетки
- Molex 39-01-2060
- AMP P/N 106527-6

**Терминалы:** Женские контакты (гнезда), олово
- Molex 39-00-0065
- AMP P/N 106528-2 или 106529-2

**Компенсатор натяжения:** Компенсатор натяжения не должен превышать максимальный форм-фактор 0.85 дюйма в ширину x 0.75 дюйма в высоту x 1.90 дюйма в длину, исключая интегрированные петли и кабельные стяжки.
- Molex 15-04-0296
- AMP P/N 1375618-1

##### 4.3.6.3 Жгут шины

**Разъем:** Шестиконтактный (6) корпус вилки
- Molex 39-01-2061
- AMP P/N 794550-6 или 794542-6

**Терминалы:** Мужские контакты (штыри), олово
- Molex 39-00-0067
- AMP P/N 794578-1 или 794576-1

##### 4.3.6.4 Разъем VMC (прямой монтаж на печатную плату)

**Вертикальный разъем:** Мужские контакты (штыри), олово
- Molex 39-28-1063
- AMP P/N 794664-6

**Угловой разъем:** Мужские контакты (штыри), олово
- Molex 39-30-1060
- AMP P/N 794448-1

##### 4.3.6.5 Одобренные детали – Альтернативные форм-факторы

Для некоторых применений могут потребоваться конфигурации разъемов с альтернативными форм-факторами. Разъемы альтернативного форм-фактора могут использоваться при условии, что они:
- поставляются перечисленными одобренными поставщиками
- являются частью портфолио продуктов одобренного поставщика
- совместимы с перечисленными одобренными номерами деталей разъемов
- соответствуют целевым показателям производительности, установленным в данной спецификации
#### 4.3.7 Расположение контактов разъема

**Назначение контактов:**
- Линия 1 - 34 VDC
- Линия 2 - Возврат питания DC
- Линия 3 - N/C (Не подключен)
- Линия 4 - Master Receive (Прием Master)
- Линия 5 - Master Transmit (Передача Master)
- Линия 6 - Communications Common (Общий провод связи)

```
Разъем периферийного устройства         Разъем VMC / шины
      Вид спереди                         Вид спереди
     Гнезда (розетка)                    Штыри (вилка)

    ┌─────────────┐                    ┌─────────────┐
    │ ┌─────────┐ │                    │ ●       ●  │
    │ │ ○     ○ │ │                    │   3     6  │
    │ │   6   3 │ │                    │ ●       ●  │
    │ │ ○     ○ │ │                    │   2     5  │
    │ │   5   2 │ │                    │ ●       ●  │
    │ │ ○     ○ │ │                    │   1     4  │
    │ │   4   1 │ │                    └─────────────┘
    │ └─────────┘ │
    └─────────────┘

    Периферийный                          VMC / Шина
      разъем                               разъем
```

**Примечания:**
1. На схеме показан вид спереди на оба разъема
2. Периферийный разъем содержит гнезда (розетка)
3. Разъем VMC/шины содержит штыри (вилка)
4. Нумерация контактов зеркальная для обеспечения правильного соединения
5. При подключении разъемов контакт 1 соединяется с контактом 1, 2 с 2 и т.д.
