# MDB Cashless Slave для ESP32

## Описание

Этот проект реализует эмуляцию MDB Cashless устройства (slave) для ESP32. Проект позволяет ESP32 взаимодействовать с торговыми автоматами (VMC) по протоколу MDB (Multi-Drop Bus) в качестве безналичного платежного терминала.

## Особенности

- Полная поддержка протокола MDB Cashless Device Level 1
- Автоматическое одобрение запросов на продажу
- Подробное логирование всех команд от MDB мастера
- Настраиваемые GPIO пины для RX, TX и LED индикации
- Модульная архитектура с разделением на компоненты

## Структура проекта

```
/
├── components/
│   └── mdb_slave/           # Компонент для работы с MDB
│       ├── include/         # Заголовочные файлы
│       │   ├── mdb_slave.h  # Основной API
│       │   └── mdb_protocol.h # Низкоуровневые функции протокола
│       ├── mdb_slave.c      # Реализация MDB Cashless Device
│       ├── mdb_protocol.c   # Реализация базовых операций MDB
│       └── CMakeLists.txt   # Конфигурация сборки компонента
├── main/
│   ├── main.c              # Основной файл приложения
│   ├── CMakeLists.txt      # Конфигурация сборки основного компонента
│   └── Kconfig.projbuild   # Настройки проекта для menuconfig
└── CMakeLists.txt          # Основной файл конфигурации сборки
```

## Настройка и сборка

1. Настройте GPIO пины через меню конфигурации:
   ```
   idf.py menuconfig
   ```
   Перейдите в раздел "MDB Cashless Configuration" для настройки пинов.

2. Соберите проект:
   ```
   idf.py build
   ```

3. Загрузите прошивку на устройство:
   ```
   idf.py -p PORT flash
   ```

4. Мониторинг логов:
   ```
   idf.py -p PORT monitor
   ```

## Подключение к торговому автомату

Для подключения к MDB шине торгового автомата требуется соответствующий адаптер уровней сигнала, так как MDB использует 9-битную передачу данных с уровнями напряжения 0/24В.

## API

Основные функции для работы с MDB:

- `mdb_slave_init()` - инициализация MDB slave
- `mdb_start_session()` - начало сессии с указанием доступных средств
- `mdb_cancel_session()` - отмена текущей сессии
- `mdb_approve_vend()` - одобрение запроса на продажу
- `mdb_deny_vend()` - отклонение запроса на продажу
- `mdb_register_vend_callback()` - регистрация обработчика запросов на продажу

## Лицензия

MIT
